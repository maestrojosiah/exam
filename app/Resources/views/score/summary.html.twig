{% extends 'base.html.twig' %}
{% block body %}
<body>
{{ include('templates/header.html.twig') }}        		
{{ include('templates/aside.html.twig') }}        		
{% embed "templates/content_draft.html.twig" %}
	{% block content %}
			<div class="col-lg-12">
        <section class="panel">
            <header class="panel-heading">
              Exam Report Summary for {{exam.cTitle}} [{{class.cTitle}}]
              <div class="pull-right">
              <a class="btn btn-sm btn-primary" href="{{ path('download_exam', {'classId': class.id, 'companyId': exam.id}) }}">Download PDF</a>
              <a class="btn btn-sm btn-primary" href="{{ path('download_exam_img', {'classId': class.id, 'companyId': exam.id}) }}">Download Image</a>
              </div>
            </header>
            {% set parents = [] %}
            {% for childSubject in childSubjects %}
              {% if childSubject.subject.sTitle not in parents %}
                {% set parents = parents|merge([childSubject.subject.sTitle]) %}
              {% endif %}
            {% endfor %}
            <table class="table table-striped table-advance table-hover">
             <tbody>
                <tr>
                  <th style="text-nowrap" class="col-md-3">Name</th>
                  {% for subject in subjects %}
                    {% if subject.sTitle in parents %}
                      {% for c_subject in subject.childSubjects %}
                      <th>{{c_subject.cSTitle}}</th>
                      {% endfor %}
                    {% endif %}
                    <th style="color:red">{{subject.sTitle}}</th>
                  {% endfor %}
                  <th>Total</th>
                  <th>Position</th>
                </tr>
                {% for key, item in sum %}
                <tr>
                	<td style="text-nowrap; font-weight:bold; color:black;">{{item[2].names}}</td>
                    {% for subject in subjects %}
                    {% if subject.childSubjects|length > 1 %}
                      {% for childSub in subject.childSubjects %}
                        {% set c_sub_key = item[2].id ~ "." ~ childSub.id ~ "." ~ "c" %}
                        {% if key_list_c[c_sub_key][c_sub_key] is defined %}
                          <td style="color:blue">{{key_list_c[c_sub_key][c_sub_key].marks}}</td>
                        {% else %}
                          <td style="color:blue">_</td>
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                    {% set st_sub_key = item[2].id ~ "." ~ subject.id ~ "." ~ "s" %}
                      {% if key_list_s[st_sub_key][st_sub_key] is defined %}
                        <td style="color:red">{{key_list_s[st_sub_key][st_sub_key].marks}}</td>
                      {% else %}
                        <td style="color:red">_</td>
                      {% endif %}
                    {% endfor %}
                	<td>{{item[0]}}</td>
                	<td>{{item[1]}}</td>
                </tr>
                {% endfor %}
              <tr>
					<td>Total Score</td>
					{% set total_score  = 0 %}
					{% for subject in subjects %}
						{% set total_score = total_score + sum_sub[subject.id][0] %}
                		{% if subject.sTitle in parents %}
                			{% for child in subject.childSubjects %}
                				<td>{{c_sum_sub[child.id][0]}}</td>
                			{% endfor %}
                		{% endif %}
						<td style="color:black;">{{sum_sub[subject.id][0]}}</td>
					{% endfor %}
					<td style="color:black;">{{total_score}}</td>
              </tr>
              <tr>
					<td>Mean Score</td>
					{% set total_mean  = 0 %}
					{% for subject in subjects %}
						{% set mean = sum_sub[subject.id][0] / students|length %}
						{% set total_mean = total_mean + mean %}
                		{% if subject.sTitle in parents %}
                			{% for child in subject.childSubjects %}
								{% set mean_child = c_sum_sub[child.id][0] / students|length %}
                				<td>{{mean_child|round(2)}}</td>
                			{% endfor %}
                		{% endif %}
						<td style="color:black;">{{mean|round(2)}}</td>
					{% endfor %}
					<td style="color:black;">{{total_mean|round(2)}}</td>
              </tr>
              <tr>
					<td>Position</td>
					{% for subject in subjects %}
                		{% if subject.sTitle in parents %}
                			{% for child in subject.childSubjects %}
                				<td></td>
                			{% endfor %}
                		{% endif %}
						<td style="color:red;">{{sum_sub[subject.id][1]}}</td>
					{% endfor %}
              </tr>
             </tbody>
          </table>
        </section>
      </div>

{% endblock %}
{% endembed %}
{% endblock %}
